language: cpp

compiler:
  - gcc

cache: ccache
  
matrix:
  include:
    - os: linux
      dist: bionic
      addons:
        apt:
          packages:
            - gfortran
            - liblapack-dev
            - libmetis-dev

before_script:
  - git clone https://github.com/coin-or/coinbrew
  - cd coinbrew
  - rm -rf /home/travis/build/coin-or/SHOT/ThirdParty/Ipopt
  - mkdir /home/travis/build/coin-or/SHOT/ThirdParty/Ipopt
  - rm -rf /home/travis/build/coin-or/build_ipopt
  - mkdir /home/travis/build/coin-or/build_ipopt
  - bash ./coinbrew build Ipopt@3.13 --debug --prefix=/home/travis/build/coin-or/SHOT/ThirdParty/Ipopt --no-prompt --tests none --build-dir=/home/travis/build/coin-or/build_ipopt
  - bash ./coinbrew install Ipopt --debug
  - rm -rf /home/travis/build/coin-or/SHOT/ThirdParty/Cbc
  - mkdir /home/travis/build/coin-or/SHOT/ThirdParty/Cbc
  - rm -rf /home/travis/build/coin-or/build_cbc  
  - mkdir /home/travis/build/coin-or/build_cbc  
  - bash ./coinbrew build Cbc@2.10 --verbosity 4 --prefix=/home/travis/build/coin-or/SHOT/ThirdParty/Cbc --no-prompt --tests none --build-dir=/home/travis/build/coin-or/build_cbc
  - bash ./coinbrew install Cbc --debug
  - mkdir /home/travis/build/coin-or/SHOT/build
  - cd /home/travis/build/coin-or/SHOT/build
  - cmake .. -DHAS_CBC=on -DCBC_DIR=/home/travis/build/coin-or/SHOT/ThirdParty/Cbc -DHAS_IPOPT=ON -DIPOPT_DIR=/home/travis/build/coin-or/SHOT/ThirdParty/Ipopt -DHAS_GAMS=off -DHAS_CPLEX=off -DHAS_GUROBI=off -DCOMPILE_TESTS=on -DSPDLOG_STATIC=off

script:
  - make -j5
  - make test

after_script:
